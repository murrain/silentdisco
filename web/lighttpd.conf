server.document-root = "/srv/http"
server.port = 80

server.modules = (
  "mod_access",
  "mod_accesslog",
  "mod_redirect",
  "mod_setenv",
  "mod_rewrite"
)

index-file.names = ( "index.html", "index.htm" )

mimetype.assign = (
  ".html" => "text/html",
  ".htm"  => "text/html",
  ".css"  => "text/css",
  ".js"   => "application/javascript",
  ".png"  => "image/png",
  ".jpg"  => "image/jpeg",
  ".jpeg" => "image/jpeg",
  ".svg"  => "image/svg+xml",
  ".m3u"  => "audio/x-mpegurl",
  ".xspf" => "application/xspf+xml",
  "/stream" => "audio/x-mpegurl"
)

accesslog.filename = "/var/log/lighttpd/access.log"

# Players hitting "/" → playlist (302)
$HTTP["useragent"] =~ "(VLC|libvlc|mpv|Kodi|MXPlayer|nPlayer|OPlayer|Infuse|BSPlayer)" {
  url.redirect = ( "^/$" => "/stream.m3u" )
}

# Friendly shortcut: /stream → /stream.m3u
url.redirect += ( "^/stream$" => "/stream.m3u" )

# Only rewrite root to index.html (do NOT rewrite other paths)
url.rewrite-once = ( "^/$" => "/index.html" )